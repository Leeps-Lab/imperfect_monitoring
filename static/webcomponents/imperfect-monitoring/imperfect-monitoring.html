<link
    rel="import"
    href="/static/bower_components/polymer/polymer.html" />
<link
    rel="import"
    href="/static/otree-redwood/webcomponents/redwood-channel/redwood-channel.html">
<link
    rel="import"
    href="/static/otree-redwood/webcomponents/redwood-decision/redwood-decision.html">
<link
    rel="import"
    href="/static/otree-redwood/webcomponents/redwood-period/redwood-period.html">
<link
    rel="import"
    href="/static/webcomponents/imperfect-monitoring/cur-subperiod-graph.html">
<link
    rel="import"
    href="/static/webcomponents/imperfect-monitoring/history-graph.html">
<link
    rel="import"
    href="/static/webcomponents/imperfect-monitoring/average-graph.html">

<dom-module id="imperfect-monitoring">

<template>
    <style>
        .container * {
            display: inline-block;
        }
    </style>

    <cur-subperiod-graph
        payoff-matrix="[[ _myPayoffs ]]"
        subperiod-length="[[ subperiodLength ]]"
        a-color="[[ aColor ]]"
        b-color="[[ bColor ]]">
    </cur-subperiod-graph>

    <button type="button" on-tap="_newInput">add payoff</button>
    <button type="button" on-tap="_addAverages">add averages</button>
    <button type="button" on-tap="_addPayoffBounds">add payoff bounds</button>
    <button type="button" on-tap="_clearCurSubperiod">clear</button>

    <history-graph
        payoff-matrix="[[ _myPayoffs ]]"
        displayed-subperiods="[[ displayedSubperiods ]]"
        subperiod-length="[[ subperiodLength ]]"
        a-color="[[ aColor ]]"
        b-color="[[ bColor ]]">
    </history-graph>

    <button type="button" on-tap="_newSubperiod">add subperiod</button>

    <div class="container">
        <average-graph
            payoff-matrix="[[ _myPayoffs ]]"
            a-color="[[ aColor ]]"
            b-color="[[ bColor ]]"
            a-payoffs="[[ _aPayoffs ]]"
            b-payoffs="[[ _bPayoffs ]]"
            show-a
            show-b>
        </average-graph>
        <average-graph
            payoff-matrix="[[ _myPayoffs ]]"
            a-color="[[ aColor ]]"
            b-color="[[ bColor ]]"
            a-payoffs="[[ _aPayoffs ]]"
            show-a>
        </average-graph>
        <average-graph
            payoff-matrix="[[ _myPayoffs ]]"
            a-color="[[ aColor ]]"
            b-color="[[ bColor ]]"
            b-payoffs="[[ _bPayoffs ]]"
            show-b>
        </average-graph>
    </div>

    <button type="button" on-tap="_addAPayoff">add A payoff</button>
    <button type="button" on-tap="_addBPayoff">add B payoff</button>

</template>

<script>
    Polymer({
        is: 'imperfect-monitoring',
        properties: {
            payoffMatrix: Array,
            probabilityMatrix: Array,
            myDecision: {
                type: Number,
            },
            periodLength: Number,
            aColor: {
                type: String,
                value: '#99C599',
            },
            bColor: {
                type: String,
                value: '#FFB899',
            },
            subperiodLength: {
                type: Number,
            },
            restLength: {
                type: Number,
            },
            displayedSubperiods: {
                type: Number,
            },
            initialDecision: {
                type: Number,
            },
            displayAverageAGraph: {
                type: Boolean,
                value: false,
            },
            displayAverageBGraph: {
                type: Boolean,
                value: false,
            },
            displayAverageABGraph: {
                type: Boolean,
                value: false,
            },
            displayPayoffMatrix: {
                type: Boolean,
                value: false,
            },
            displayScore: {
                type: Boolean,
                value: false,
            },
            _curRealizedPayoffs: {
                type: Array,
                value: function() { return []; },
            },
            _myPayoffs: {
                type: Array,
                computed: '_computeMyPayoffs(payoffMatrix)',
            },
            _aPayoffs: {
                type: Array,
                value: () => [],
            },
            _bPayoffs: {
                type: Array,
                value: () => [],
            },
        },
        ready() {
            
        },
        _newInput() {
            this.$$('cur-subperiod-graph').addPayoff(Math.random() * 125);
        },
        _computeMyPayoffs(payoffMatrix) {
            return payoffMatrix.map(e => e[oTree.idInGroup - 1]);
        },
        _addAverages() {
            this.$$('cur-subperiod-graph').addAverageLine();
        },
        _addPayoffBounds() {
            const decision = Math.floor(Math.random() * 2);
            this.$$('cur-subperiod-graph').addPayoffBounds(decision);
        },
        _clearCurSubperiod() {
            this.$$('cur-subperiod-graph').clearGraph();
        },
        _newSubperiod() {
            let realized_payoffs = [];

            for (let i = 0; i < this.subperiodLength; i++) {
                realized_payoffs.push({value: Math.random() * 125});
            }

            let decision = Math.floor(Math.random() * 2);
            this.$$('history-graph').addSubperiod(realized_payoffs, decision);
        },
        _addAPayoff() {
            this.push('_aPayoffs', {value: Math.random() * 125});
        },
        _addBPayoff() {
            this.push('_bPayoffs', {value: Math.random() * 125});
        },
    });
</script>

</dom-module>